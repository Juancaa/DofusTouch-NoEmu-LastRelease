{"version":3,"sources":["../src/browser/app/main/game/game.component.ts"],"names":[],"mappings":"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","file":"game.component.js","sourcesContent":["import {\n    Component, Input, Inject, NgZone, OnInit, AfterViewInit, Pipe, PipeTransform, Output,\n    EventEmitter\n} from '@angular/core';\nimport {Tab} from './../tab/tab';\nimport {Shortcuts} from './mods/shortcuts/shortcuts';\nimport * as async from 'async';\nimport {IpcRendererService} from './../../../shared/electron/ipcrenderer.service';\nimport {TranslateService} from \"ng2-translate\";\nimport {SettingsService} from './../../../shared/settings/settings.service';\nimport {ApplicationService} from \"./../../../shared/electron/application.service\";\nimport {DomSanitizer, SafeUrl, Title} from \"@angular/platform-browser\";\nimport {AutoGroup} from \"./mods/auto-group/autogroup\";\nimport {Inactivity} from \"./mods/general/inactivity\";\nimport {HealthBar} from \"./mods/health-bar/healthbar\";\nimport {Notifications} from \"./mods/notifications/notifications\";\nimport {DamageEstimator} from \"./mods/damage-estimator/damageestimator\";\nimport {CssOverload} from \"./mods/cssOverload/cssOverload\";\nimport {RapidExchange} from \"./mods/rapid-exchange/rapid-exchange\";\nimport {WizAssetsContainer} from \"./wizAssets/wizAssetsContainer\";\nimport {HideShop} from \"./mods/hide-shop/hide-shop\";\nimport {Http} from \"@angular/http\";\nimport {PluginsContainer} from \"./plugins/pluginsContainer\";\nimport {Game} from \"./game\";\n\n\nconst {remote} = (<any>global).nodeRequire('electron');\n\n@Pipe({name: 'safe'})\nexport class SafePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {\n    }\n\n    transform(url: string) {\n        return this.sanitizer.bypassSecurityTrustResourceUrl(url);\n    }\n}\n\n@Component({\n    selector: 'game',\n    templateUrl: 'app/main/game/game.component.html',\n    styleUrls: ['app/main/game/game.component.css']\n})\nexport class GameComponent implements OnInit, AfterViewInit {\n\n    @Input() private game: Game;\n    @Output() selected = new EventEmitter();\n    private shortcuts: Shortcuts;\n    private gamePath: string;\n    private gameLoaded: boolean = false;\n    private backupMaxZoom: number;\n\n    // Mods\n    private autogroup: AutoGroup;\n    private inactivity: Inactivity;\n    private healthbar: HealthBar;\n    private damageEstimator: DamageEstimator;\n    private notifications: Notifications;\n    private cssOverload: CssOverload;\n    private rapidExchange: RapidExchange;\n    private wizAssets: WizAssetsContainer;\n    private plugins: PluginsContainer;\n    private hideShop: HideShop;\n\n    constructor(@Inject('Window') private window: Window,\n                private ipcRendererService: IpcRendererService,\n                private zone: NgZone,\n                private settingsService: SettingsService,\n                private translate: TranslateService,\n                private applicationService: ApplicationService,\n                private http: Http,\n                private titleService: Title) {\n        this.gamePath = this.applicationService.gamePath + '/index.html';\n    }\n\n    ngOnInit() {\n\n    }\n\n    ngAfterViewInit() {\n        // after View Init get the iFrame\n        this.game.window = this.window['Frame' + this.game.id].contentWindow;\n    }\n\n    private gameReady(): void {\n\n        if (this.gameLoaded) {\n\n            /* Hide the game loading overlay */\n            let loading = document.getElementById(\"LoadingGame_\" + this.game.id);\n            loading.style.opacity = '0';\n            setTimeout(function () {\n                loading.remove();\n            }, 500);\n\n            this.plugins = new PluginsContainer(this.game.window);\n\n            this.setEventListener();\n            this.setMods();\n\n            // If the tab has credentials, connect the account\n            // Then delete credentials\n            if (this.game.credentials)\n                this.connectAccount();\n\n            this.ipcRendererService.on('reload-settings-done', () => {\n                this.reloadMods();\n            });\n        }\n\n        this.gameLoaded = true;\n    }\n\n    public reloadMods(start: boolean = true): void {\n        switch (this.applicationService.vipStatus) {\n            case 5:\n            case 4:\n            case 3:\n                if (this.healthbar) this.healthbar.reset();\n            case 2:\n                if (this.autogroup) this.autogroup.reset();\n                if (this.inactivity) this.inactivity.reset();\n                if (this.damageEstimator) this.damageEstimator.reset();\n            default:\n                if (this.notifications) this.notifications.removeAllListeners();\n                if (this.notifications) this.notifications.reset();\n                if (this.shortcuts) this.shortcuts.reset();\n                if (this.cssOverload) this.cssOverload.reset();\n                if (this.hideShop) this.hideShop.reset();\n        }\n        if (start)\n            this.setMods();\n    }\n\n    public setMods(): void {\n\n        switch (this.applicationService.vipStatus) {\n            case 5:\n            case 4:\n            case 3:\n                this.healthbar = new HealthBar(this.game.window, this.settingsService.option.vip.general);\n            case 2:\n                this.autogroup = new AutoGroup(this.game.window, this.settingsService.option.vip.autogroup, this.ipcRendererService);\n                this.inactivity = new Inactivity(this.game.window, this.settingsService.option.vip.general.disable_inactivity);\n                this.damageEstimator = new DamageEstimator(this.game.window, this.settingsService.option.vip.general);\n            default:\n                this.notifications = new Notifications(this.game.window, this.settingsService.option.notification, this.translate);\n                this.notifications.on('newNotification', () => {\n                    this.zone.run(() => {\n                        this.game.emit('notification');\n                    });\n                });\n                this.notifications.on('focusTab', () => {\n                    this.zone.run(() => {\n                        this.selected.emit(this.game);\n                    });\n                });\n                this.shortcuts = new Shortcuts(this.game.window, this.settingsService.option.shortcuts);\n                this.cssOverload = new CssOverload(this.game.window);\n                this.hideShop = new HideShop(this.game.window, this.settingsService.option.general.hidden_shop);\n                this.rapidExchange = new RapidExchange(this.game.window);\n                this.wizAssets = new WizAssetsContainer(this.game.window, this.applicationService, this.http, this.settingsService.option.general);\n        }\n    }\n\n    private setEventListener(): void {\n\n        var canvas = this.game.window.document.getElementById(\"mapScene-canvas\");\n        canvas.addEventListener(\"webglcontextlost\", (event: any) => {\n            console.log('reload webglcontext cause: webglcontextlost');\n            this.game.window.isoEngine.background.render()\n            event.preventDefault();\n        }, false);\n\n        // event -> resize window game\n        this.game.window.onresize = () => {\n            //if(this.game.window.gui.isConnected){\n            try {\n                this.game.window.gui._resizeUi();\n            } catch (e) {\n            }\n\n            this.checkMaxZoom();\n            //}\n        };\n\n        let onCharacterSelectedSuccess = () => {\n            // retrieve character name and update zone.js\n            this.zone.run(() => {\n                this.game.emit('character', this.game.window.gui.playerData.characterBaseInformations.name);\n                this.game.emit('logged', true);\n                this.titleService.setTitle(this.game.window.gui.playerData.characterBaseInformations.name);\n            });\n\n            this.checkMaxZoom();\n        };\n\n        let onDisconnect = () => {\n            this.zone.run(() => {\n                this.game.emit('character', null);\n                this.game.emit('logged', false);\n            });\n        }\n\n        this.game.window.gui.playerData.on(\"characterSelectedSuccess\", onCharacterSelectedSuccess);\n        this.game.window.gui.on(\"disconnect\", onDisconnect);\n\n        this.game.window.isoEngine.mapScene._refreshAreasBackup = this.game.window.isoEngine.mapScene._refreshAreas;\n        this.game.window.isoEngine.mapScene._refreshAreas = function () {\n            for (var id in this.areasToRefresh) {\n                if (this.areasToRefresh[id][3] < this.t) {\n                    this.areasToRefresh[id][2] = this.t;\n                    this.areasToRefresh[id][3] = this.t + 5;\n                }\n            }\n            this._refreshAreasBackup();\n        }\n    }\n\n    private checkMaxZoom() {\n        if (!this.backupMaxZoom) this.backupMaxZoom = this.game.window.isoEngine.mapScene.camera.maxZoom;\n        this.game.window.isoEngine.mapScene.camera.maxZoom = Math.max(\n            this.backupMaxZoom,\n            this.backupMaxZoom + (this.game.window.isoEngine.mapScene.canvas.height / 800 - 1)\n        );\n    }\n\n    // Connect the account to the last character connected\n    private connectAccount() {\n        setTimeout(() => {\n            this.selected.emit(this.game);\n            let credentials = this.game.credentials;\n            delete (this.game.credentials);\n            this.game.window.gui.loginScreen._connectMethod = \"lastCharacter\";\n            this.game.window.gui.loginScreen._login(credentials.account_name, credentials.password, false);\n        }, this.game.id * 1000);\n    }\n}\n"]}