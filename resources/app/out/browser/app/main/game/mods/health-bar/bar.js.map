{"version":3,"sources":["../src/browser/app/main/game/mods/health-bar/bar.ts"],"names":[],"mappings":"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","file":"bar.js","sourcesContent":["import {BarContainer} from \"./barcontainer\";\nexport class Bar {\n\n    private fighter: any;\n    private wGame: any;\n\n    private lifeBarContainer : HTMLDivElement;\n    private lifeBar : HTMLDivElement;\n    private shieldBar : HTMLDivElement;\n    private lifePointsText : HTMLDivElement;\n    private container : BarContainer;\n\n    constructor(fighter: any, container: BarContainer, wGame: any | Window){\n        this.fighter = fighter;\n        this.wGame = wGame;\n        this.container = container;\n\n        this.createBar();\n\n    }\n\n    public getId(){\n        return this.fighter.id;\n    }\n\n    public update(){\n        let fighter = this.wGame.gui.fightManager.getFighter(this.fighter.id);\n\n        if (this.wGame.gui.fightManager.isInBattle()) {\n\n            if (fighter.data.alive) {\n                if (!this.lifeBar || !this.lifeBarContainer || !this.lifePointsText) {\n                    this.createBar();\n                }\n\n                let life = fighter.data.stats.lifePoints / fighter.data.stats.maxLifePoints;\n                let shield = fighter.data.stats.shieldPoints / fighter.data.stats.maxLifePoints;\n                this.lifeBar.style.width = Math.round(life * (shield > 0 ? 50 : 100)) + '%';\n                this.shieldBar.style.width = Math.round(shield * 50) + '%';\n                this.lifePointsText.innerHTML = fighter.data.stats.lifePoints + fighter.data.stats.shieldPoints;\n\n                if (shield > 0) {\n                    this.lifeBar.style.right = '50%';\n                }\n                else {\n                    this.lifeBar.style.right = '';\n                }\n\n                let invisible = false;\n                for (let idB in fighter.buffs) {\n                  if (fighter.buffs[idB].effect.effectId == 150) invisible = true;\n                }\n\n                let cellId = fighter.data.disposition.cellId;\n\n                if (cellId && (!invisible || this.wGame.gui.fightManager.isFighterOnUsersTeam(fighter.id))) {\n                    try {\n                        let scenePos = this.wGame.isoEngine.mapRenderer.getCellSceneCoordinate(cellId);\n                        let pos = this.wGame.isoEngine.mapScene.convertSceneToCanvasCoordinate(scenePos.x, scenePos.y);\n                        this.lifeBarContainer.style.left = (pos.x - this.lifeBarContainer.offsetWidth / 2) + 'px';\n                        this.lifeBarContainer.style.top = (pos.y) + 'px';\n                        this.lifeBarContainer.style.opacity = '';\n                        this.lifePointsText.style.opacity = '';\n                        if (this.container.getShowLifePoints()) {\n                            this.lifePointsText.style.display = '';\n                            this.lifePointsText.style.left = (pos.x - this.lifeBarContainer.offsetWidth / 2) + 'px';\n                            this.lifePointsText.style.top = (pos.y) + 'px';\n                        }\n                        else {\n                            this.lifePointsText.style.display = 'none';\n                        }\n                    }\n                    catch(e) {\n                        console.log(cellId);\n                        console.error(e);\n                    }\n                }\n                else if (invisible) {\n                    this.lifeBarContainer.style.opacity = '0.5';\n                    this.lifePointsText.style.opacity = '0.5';\n                }\n            }\n        }\n    }\n\n    private createBar(){\n        /* retrieve data */\n        let life = this.fighter.data.stats.lifePoints / this.fighter.data.stats.maxLifePoints;\n        let cellId = this.fighter.data.disposition.cellId;\n        let scenePos = this.wGame.isoEngine.mapRenderer.getCellSceneCoordinate(cellId);\n        let pos = this.wGame.isoEngine.mapScene.convertSceneToCanvasCoordinate(scenePos.x, scenePos.y);\n\n        /* lifeBarContainer */\n        this.lifeBarContainer = document.createElement('div');\n        this.lifeBarContainer.id = 'fighterLifeBarContainer' + this.fighter.id;\n        this.lifeBarContainer.className = 'lifeBarContainer';\n\n        if (this.fighter.data.teamId == 0) this.lifeBarContainer.style.borderColor = 'red';\n        else this.lifeBarContainer.style.borderColor = '#3ad';\n\n        /* lifeBar */\n        this.lifeBar = document.createElement('div');\n        this.lifeBar.id = 'fighterLifeBar' + this.fighter.id;\n        this.lifeBar.className = 'lifeBar';\n\n        if (this.fighter.data.teamId == 0) this.lifeBar.style.backgroundColor = 'red';\n        else this.lifeBar.style.backgroundColor = '#3ad';\n        this.lifeBarContainer.appendChild(this.lifeBar);\n\n        /* shieldBar */\n        this.shieldBar = document.createElement('div');\n        this.shieldBar.id = 'fighterShieldBar' + this.fighter.id;\n        this.shieldBar.className = 'shieldBar';\n\n        this.lifeBarContainer.appendChild(this.shieldBar);\n\n        /* lifePointsText */\n        this.lifePointsText = document.createElement('div');\n        this.lifePointsText.id = 'fighterLifePoints' + this.fighter.id;\n        this.lifePointsText.className = 'lifePointsText';\n\n        this.wGame.document.getElementById('lifeBars').appendChild(this.lifeBarContainer);\n        this.wGame.document.getElementById('lifeBars').appendChild(this.lifePointsText);\n    }\n\n    public destroy(){\n        this.lifePointsText.parentElement.removeChild(this.lifePointsText);\n        this.lifeBar.parentElement.removeChild(this.lifeBar);\n        this.lifeBarContainer.parentElement.removeChild(this.lifeBarContainer);\n    }\n}\n"]}