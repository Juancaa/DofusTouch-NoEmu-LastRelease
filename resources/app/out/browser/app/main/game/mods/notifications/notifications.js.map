{"version":3,"sources":["../src/browser/app/main/game/mods/notifications/notifications.ts"],"names":[],"mappings":"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","file":"notifications.js","sourcesContent":["import {Option} from \"../../../../../shared/settings/settings.service\";\nimport {NgZone} from '@angular/core';\nimport {TranslateService} from 'ng2-translate';\nimport {Tab} from \"../../../tab/tab\";\nimport {Observable} from 'rxjs/Observable';\nimport {BehaviorSubject} from 'rxjs/BehaviorSubject';\nimport {EventEmitter} from 'eventemitter3';\nimport {Game} from \"../../game\";\n\n\nconst {remote} = (<any>global).nodeRequire('electron');\n\nexport class Notifications extends EventEmitter {\n\n    private wGame: any | Window;\n    private params: Option.Notification;\n    private translate: TranslateService;\n    private events: any[] = [];\n\n    constructor(wGame: any, params: Option.Notification, translate: TranslateService){\n        super();\n        this.wGame = wGame;\n        this.params = params;\n        this.translate = translate;\n\n        let onCharacterSelectedSuccess = () => {\n            let onChatServerMessage = (msg: any) => {\n                this.sendMPNotif(msg);\n            };\n            let onGameFightTurnStartMessage = (actor: any) => {\n                this.sendFightTurnNotif(actor);\n            };\n            let onTaxCollectorAttackedMessage = (tc: any) => {\n                this.sendTaxCollectorNotif(tc);\n            };\n\n            let onGameRolePlayArenaFightPropositionMessage = (tc: any) => {\n                this.sendKolizeumNotif(tc);\n            };\n\n            let onPartyInvitationMessage = (tc: any) => {\n                this.sendPartyInvitationNotif(tc);\n            };\n\n            let onGameRolePlayAggressionMessage = (tc: any) => {\n                this.sendAggressionNotif(tc);\n            };\n\n            this.wGame.dofus.connectionManager.on('ChatServerMessage', onChatServerMessage);\n            this.wGame.gui.on('GameFightTurnStartMessage', onGameFightTurnStartMessage);\n            this.wGame.dofus.connectionManager.on('TaxCollectorAttackedMessage', onTaxCollectorAttackedMessage);\n            this.wGame.dofus.connectionManager.on('GameRolePlayArenaFightPropositionMessage', onGameRolePlayArenaFightPropositionMessage);\n            this.wGame.dofus.connectionManager.on('PartyInvitationMessage', onPartyInvitationMessage);\n            this.wGame.dofus.connectionManager.on('GameRolePlayAggressionMessage', onGameRolePlayAggressionMessage);\n\n            let onDisconnect = () => {\n                this.wGame.dofus.connectionManager.removeListener('ChatServerMessage', onChatServerMessage);\n                this.wGame.gui.removeListener('GameFightTurnStartMessage', onGameFightTurnStartMessage);\n                this.wGame.dofus.connectionManager.removeListener('TaxCollectorAttackedMessage', onTaxCollectorAttackedMessage);\n                this.wGame.dofus.connectionManager.removeListener('GameRolePlayArenaFightPropositionMessage', onGameRolePlayArenaFightPropositionMessage);\n                this.wGame.dofus.connectionManager.removeListener('PartyInvitationMessage', onPartyInvitationMessage);\n                this.wGame.dofus.connectionManager.removeListener('GameRolePlayAggressionMessage', onGameRolePlayAggressionMessage);\n            };\n\n            this.wGame.gui.on(\"disconnect\", onDisconnect);\n            this.events.push(() => {\n                onDisconnect();\n                this.wGame.gui.removeListener(\"disconnect\", onDisconnect);\n            });\n        };\n\n        // Bind event when player go IG\n        this.wGame.gui.playerData.on(\"characterSelectedSuccess\", onCharacterSelectedSuccess);\n        this.events.push(() => {\n            this.wGame.gui.playerData.removeListener(\"characterSelectedSuccess\", onCharacterSelectedSuccess);\n        });\n\n        if(this.wGame.gui.isConnected){\n            onCharacterSelectedSuccess();\n        }\n    }\n\n\n    public reset() {\n        this.events.forEach((event) => {\n            event();\n        });\n        this.events = [];\n    }\n\n    private sendMPNotif(msg: any) {\n        if (!this.wGame.document.hasFocus() && this.params.private_message) {\n            if (msg.channel == 9) {\n\n                this.emit('newNotification');\n\n                let mpNotif = new Notification(this.translate.instant('app.notifications.private-message', {character: msg.senderName}), {\n                    body: msg.content\n                });\n\n                mpNotif.onclick = () => {\n                    remote.getCurrentWindow().focus();\n                    this.emit('focusTab');\n                };\n            }\n        }\n    }\n\n    private sendFightTurnNotif(actor: any) {\n        if (!this.wGame.document.hasFocus()\n            && this.wGame.gui.playerData.characterBaseInformations.id == actor.id) {\n\n            if (this.params.fight_turn) {\n\n                this.emit('newNotification');\n\n                let turnNotif = new Notification(this.translate.instant('app.notifications.fight-turn', {character: this.wGame.gui.playerData.characterBaseInformations.name}));\n\n                turnNotif.onclick = () => {\n                    remote.getCurrentWindow().focus();\n                    this.emit('focusTab');\n                };\n            }\n\n            if (this.params.focus_fight_turn) {\n                remote.getCurrentWindow().focus();\n                this.emit('focusTab');\n            }\n        }\n    }\n\n    private sendKolizeumNotif(msg: any) {\n        if (!this.wGame.document.hasFocus()\n            && this.params.fight_turn) {\n\n            this.emit('newNotification');\n\n            let kolizeumNotif = new Notification(this.translate.instant('app.notifications.kolizeum'));\n\n            kolizeumNotif.onclick = () => {\n                remote.getCurrentWindow().focus();\n                this.emit('focusTab');\n            };\n        }\n    }\n\n    private sendTaxCollectorNotif(tc: any) {\n        if (!this.wGame.document.hasFocus() && this.params.tax_collector) {\n\n            this.emit('newNotification');\n\n            let guildName = tc.guild.guildName;\n            let x = tc.worldX;\n            let y = tc.worldY;\n            let zoneName = tc.enrichData.subAreaName;\n            let tcName = tc.enrichData.firstName + \" \" + tc.enrichData.lastName;\n\n            let taxCollectorNotif = new Notification(this.translate.instant('app.notifications.tax-collector'), {\n                body: zoneName + ' [' + x + ', ' + y + '] : ' + guildName + ', ' + tcName\n            });\n\n            taxCollectorNotif.onclick = () => {\n                remote.getCurrentWindow().focus();\n                this.emit('focusTab');\n            };\n\n        }\n    }\n\n    private sendPartyInvitationNotif(tc: any) {\n        if (!this.wGame.document.hasFocus() && this.params.party_invitation) {\n            \n            this.emit('newNotification');\n\n            let fromName: string = tc.fromName;\n\n            let partyInvitationNotif = new Notification(this.translate.instant('app.notifications.party-invitation', {character: tc.fromName}));\n\n            partyInvitationNotif.onclick = () => {\n                remote.getCurrentWindow().focus();\n                this.emit('focusTab');\n            };\n        }\n    }\n\n    private sendAggressionNotif(tc: any) {\n        if (!this.wGame.document.hasFocus()\n            && this.params.aggression\n            && tc.defenderId == this.wGame.gui.playerData.characterBaseInformations.id) {\n            \n            this.emit('newNotification');\n\n            let aggressionNotif = new Notification(this.translate.instant('app.notifications.aggression'));\n\n            aggressionNotif.onclick = () => {\n                remote.getCurrentWindow().focus();\n                this.emit('focusTab');\n            };\n        }\n    }\n}"]}