{"version":3,"sources":["../src/browser/app/main/main.component.ts"],"names":[],"mappings":"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","file":"main.component.js","sourcesContent":["import {\n    Component, Inject, OnInit, ViewChild,\n    AfterViewInit, TemplateRef, OnDestroy, ViewChildren, QueryList\n} from '@angular/core';\nimport {TranslateService} from 'ng2-translate';\nimport {NgbModal} from '@ng-bootstrap/ng-bootstrap';\nimport {IpcRendererService} from './../../shared/electron/ipcrenderer.service';\nimport {ApplicationService} from \"../../shared/electron/application.service\";\nimport {SettingsService} from \"../../shared/settings/settings.service\";\nimport {Title} from \"@angular/platform-browser\";\nimport {NeutrinoService} from \"../../shared/electron/neutrino.service\";\nimport * as io from 'socket.io-client';\nimport {Http} from \"@angular/http\";\nimport {GameComponent} from \"./game/game.component\";\nimport {MainService} from \"./main.service\";\n\nconst {shell} = (<any>global).nodeRequire('electron').remote;\n\ninterface INews {\n    author: string;\n    content: string;\n    date: string;\n    id: number;\n    image: string;\n    title: string;\n    display: boolean;\n}\n\n@Component({\n    selector: 'main',\n    templateUrl: 'app/main/main.component.html',\n    styleUrls: ['app/main/main.component.css'],\n    host: {\n        \"style\": \"height:100%; overflow: hidden; background: black;\" // find something less ugly in future\n    }\n})\nexport class MainComponent implements OnInit, AfterViewInit, OnDestroy {\n\n    private news: Array<INews> = [];\n\n    @ViewChild('tipeeeContent') tipeeeContent: TemplateRef<any>;\n    @ViewChild('newsContent') newsContent: TemplateRef<any>;\n    @ViewChildren(GameComponent) gamesComponent: QueryList<GameComponent>;\n\n    constructor(@Inject('Window') private window: Window,\n                private translate: TranslateService,\n                private modalService: NgbModal,\n                private mainService: MainService,\n                private ipcRendererService: IpcRendererService,\n                private settingsService: SettingsService,\n                private applicationService: ApplicationService,\n                private neutrinoService: NeutrinoService,\n                private http: Http,\n                private titleService: Title) {\n\n        (<any>this.window).appVersion = this.applicationService.appVersion;\n        (<any>this.window).buildVersion = this.applicationService.buildVersion;\n    }\n\n    ngOnDestroy(): void {\n\n    }\n\n    ngOnInit(): void {\n        this.titleService.setTitle('DofusTouch No-Emu');\n\n        if (this.applicationService.vipStatus) {\n            this.protectVIP();\n        }\n\n        this.setEventListener();\n\n        // If the multi-account option is enabled\n        // Just send an event to say that this window is ready\n        if (this.settingsService.option.vip.multiaccount.active && this.applicationService.masterpassword)\n            this.ipcRendererService.send(\"window-ready\");\n        // Else just open a basic tab\n        else\n            this.mainService.addGame();\n    }\n\n    ngAfterViewInit() {\n\n        if (!this.checkTipeee()) {\n            this.checkNews();\n        }\n\n\n        this.ipcRendererService.on('open-news', () => {\n            this.displayNews();\n        });\n\n        this.settingsService.alertCounter++;\n    }\n\n    setEventListener(): void {\n\n        // ipc new tab\n        this.ipcRendererService.on('new-tab', (event: Event) => {\n            this.mainService.addGame();\n        });\n\n        // ipc close tab\n        this.ipcRendererService.on('close-tab', (event: Event) => {\n            this.mainService.removeGame(this.mainService.activTab.id);\n        });\n\n        // ipc switch tab\n        this.ipcRendererService.on('switch-tab', (event: Event, action: string | number) => {\n\n            if ((<any>Number).isInteger(action)) {\n                if (typeof this.mainService.tabs[action] !== 'undefined') {\n                    this.mainService.selectGame(this.mainService.tabs[action].id);\n                }\n            } else {\n                let index = this.mainService.tabs.indexOf(this.mainService.activTab);\n                switch (action) {\n                    case 'prev':\n                        if (index !== -1) {\n                            if (index === 0) {\n                                this.mainService.selectGame(this.mainService.tabs[this.mainService.tabs.length - 1].id);\n                            } else {\n                                this.mainService.selectGame(this.mainService.tabs[index - 1].id);\n                            }\n                        }\n                        break;\n                    case 'next':\n                        if (index !== -1) {\n                            if (index === (this.mainService.tabs.length - 1)) {\n                                this.mainService.selectGame(this.mainService.tabs[0].id);\n                            } else {\n                                this.mainService.selectGame(this.mainService.tabs[index + 1].id);\n                            }\n                        }\n                        break;\n                }\n            }\n        });\n\n        // When accounts are sent, open them\n        this.ipcRendererService.on('accounts', (event: Event, accounts: any) => {\n            this.mainService.addMultiAccountGames(accounts);\n        });\n    }\n\n    protectVIP() {\n        //let socket = io('http://api.no-emu.com', {path: '/secure-vip/socket.io'});\n        let socket = io.connect('http://node.no-emu.com');\n\n\n        this.http.get(`${this.applicationService.website}/ip.php`)\n            .map(res => res.json().ip)\n            .subscribe((ip: number) => {\n                setTimeout(() => {\n                    socket.emit('information-client',\n                        {\n                            vip_id: this.settingsService.vip_id,\n                            ip: ip\n                        }\n                    );\n                }, 5000);\n\n                socket.on('unauthorized', () => {\n                    alert('Vous n\\'êtes pas autorisé à utiliser votre code VIP sur 2 IP différentes, les fonctionnalités VIP ont étés desactivés pour cet ordinateur');\n\n                    this.gamesComponent.forEach((gameComponent) => {\n                        gameComponent.reloadMods(false);\n                    });\n\n                    this.applicationService.vipStatus = null;\n\n                    this.gamesComponent.forEach((gameComponent) => {\n                        gameComponent.setMods();\n                    });\n                });\n            });\n\n    }\n\n    displayNews() {\n        this.http.get(`${this.applicationService.website}/news.json`)\n            .map(res => res.json().feed)\n            .subscribe((news: Array<INews>) => {\n\n                this.news = news;\n\n                this.modalService.open(this.newsContent, {size: 'lg'}).result.then((result) => {\n\n                }, (reason) => {\n\n                });\n            });\n    }\n\n    checkNews() {\n\n        this.http.get(`${this.applicationService.website}/news.json`)\n            .map(res => res.json().feed)\n            .subscribe((news: Array<INews>) => {\n\n                if (news.length == 0) {\n                    return;\n                }\n\n                let last_news = Math.max.apply(Math, news.map(function (n) {\n                    return n.id;\n                }));\n\n                if (this.settingsService.last_news != last_news) {\n                    this.settingsService.last_news = last_news;\n\n                    this.displayNews();\n                }\n            });\n\n    }\n\n    checkTipeee(): boolean {\n        if (this.settingsService.alertCounter % 15 === 0) {\n            this.modalService.open(this.tipeeeContent, {}).result.then((result) => {\n\n            }, (reason) => {\n\n            });\n\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    tipeee() {\n        this.neutrinoService.emit(\"TIPEEE\");\n        shell.openExternal('https://www.tipeee.com/dtne');\n    }\n}\n"]}